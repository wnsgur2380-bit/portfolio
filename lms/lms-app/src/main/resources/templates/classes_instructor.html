<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security6"
      layout:decorate="~{layout}">

<head>
    <title th:text="${instructor.userName} + ' 님의 강의 목록'"></title>
</head>

<body>
    <th:block layout:fragment="content">
        <div class="container my-4">

            <section>
                 <div class="d-flex justify-content-between align-items-center mb-3">
                    <div>
                        <h3 class="mb-0 fw-bold" th:text="${instructor.userName} + ' 님의 강의 목록'"></h3>
                        <span class="text-muted" th:text="${instructor.email}"></span>
                    </div>
                    <span class="text-muted" th:text="|총 ${paging.totalElements}개 강의|"></span>
                </div>
				
				<div class="row justify-content-end mb-4">
				    <div class="col-md-8">
                        <form th:action="@{/classes/instructor/{uno}(uno=${instructor.uno})}" method="get" id="searchForm" class="input-group">
				            <input type="hidden" id="page" name="page" th:value="${paging.number}">

				            <select class="form-select" name="levelId" style="max-width: 150px;">
				                <option value="0" th:selected="${levelId == 0}">전체 난이도</option>
				                <option value="1" th:selected="${levelId == 1}">초급</option>
				                <option value="2" th:selected="${levelId == 2}">중급</option>
				                <option value="3" th:selected="${levelId == 3}">고급</option>
				            </select>

				            <input type="text" name="kw" class="form-control" th:value="${kw}" placeholder="강의 제목 검색">
				            <button class="btn btn-outline-secondary" type="button" onclick="document.getElementById('page').value=0; document.getElementById('searchForm').submit();">검색</button>
				        </form>
				    </div>
				</div>

                <div class="row g-3">
                    <div th:if="${!paging.hasContent()}" class="col-12">
                        <div class="alert alert-secondary text-center py-5">
                            등록된 강의가 없습니다.
                        </div>
                    </div>

                    <div class="col-md-6 col-lg-4" th:each="cls : ${paging}"> <div class="card h-100 shadow-sm border-0">
                           
                           <div class="card-body p-4 position-relative">
                               <span class="badge bg-info position-absolute top-0 start-0 m-3"
                                     th:text="${cls.level?.levelName ?: 'N/A'}"></span>

                               <div th:if="${cls.classesImg != null and !cls.classesImg.isEmpty()}"
                                    class="text-center bg-light" style="height: 180px; overflow: hidden;">
                                   <img th:src="${cls.classesImg}" class="card-img-top" alt="강의 이미지" style="width: 100%; height: 100%; object-fit: cover;">
                               </div>
                               <div th:unless="${cls.classesImg != null and !cls.classesImg.isEmpty()}"
                                    class="text-center d-flex align-items-center justify-content-center bg-light" style="height: 180px;">
                                   <i class="bi bi-book display-1 text-muted"></i>
                               </div>

                               <h5 class="card-title fw-bold mt-3">
                                   <a th:href="@{|/classes/${cls.classesId}|}" th:text="${cls.title}" class="text-decoration-none"></a>
                               </h5>
                               <p class="card-text text-muted small" th:text="${#strings.abbreviate(cls.classesContent, 100)}"></p>
                           </div>
                           
                           <div class="card-footer bg-white border-0 p-4 pt-0 d-flex justify-content-between align-items-center">
                               <span class="text-muted small">
                                   <i class="bi bi-person-fill"></i>
                                   <span th:if="${cls.user != null}" th:text="${cls.user.userName}"></span>
                               </span>
                               
                               <div sec:authorize="hasRole('ROLE_LEARNER')">
                                   <form th:action="@{'/enrollment/create/' + ${cls.classesId}}" method="post" style="display:inline;">
                                       <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                                       <button type="submit" class="btn btn-sm btn-primary">수강신청</button>
                                   </form>
                               </div>
                               <div sec:authorize="!isAuthenticated()">
                                   <a th:href="@{/user/login}" class="btn btn-sm btn-outline-primary">로그인 후 신청</a>
                               </div>
                               <div sec:authorize="hasAnyRole('ROLE_INSTRUCTOR', 'ROLE_ADMIN')">
                                   <a th:href="@{|/classes/${cls.classesId}|}" class="btn btn-sm btn-outline-secondary">강의 보기</a>
                               </div>
                           </div>
                           
                        </div>
                    </div> </div>
                
                <div th:replace="~{pagination :: paging(${paging})}"></div>

            </section>
        </div>
    </th:block>
</body>
</html>