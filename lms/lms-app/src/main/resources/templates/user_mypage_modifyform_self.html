<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layout}">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>내 정보 수정</title>
</head>

<body class="bg-light">
	<th:block layout:fragment="content">
		<!-- 수정 성공 시 alert (기존 코드 유지, 단 alert()은 iframe에서 작동 안 할 수 있습니다) -->
		<div th:if="${message}">
			<script th:inline="javascript">
				let msg = /*[[${message}]]*/ "";
				alert(msg);
			</script>
		</div>
		<div class="container d-flex align-items-center my-5" style="min-height: 80vh;">
			<div class="row w-100 justify-content-center">


				<div class="col-md-6">
					<div class="card shadow-sm border-0 p-4">
						<div class="card-body">
							<h5 class="fw-bold text-center mb-4 text-secondary">내 정보 수정</h5>

							<form th:action="@{/user/modify}" th:object="${userModifyForm}" method="post">
								<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
								<!-- [수정] form_errors.html은 이제 글로벌 오류만 표시합니다. -->
								<div th:replace="~{form_errors :: formErrorsFragment}"></div>

								<div class="mb-3">
									<label for="userId" class="form-label fw-bold ms-3">회원 ID</label>
									<input type="text" class="form-control rounded-pill p-3" th:value="${user.userId}"
										disabled readonly>
								</div>
								<div class="mb-3">
									<label for="userName" class="form-label fw-bold ms-3">이름</label>
									<input type="text" class="form-control rounded-pill p-3" th:value="${user.userName}"
										disabled readonly>
								</div>

								<div class="mb-3">
									<label for="currentPassword" class="form-label fw-bold ms-3">현재 비밀번호</label>
									<input type="password" class="form-control rounded-pill p-3"
										th:field="*{currentPassword}" placeholder="필수 입력"
										th:classappend="${#fields.hasErrors('currentPassword')} ? 'is-invalid' : ''">
									<!-- ▼▼▼ [ "필드별" 오류 메시지 추가 ] ▼▼▼ -->
									<div class="invalid-feedback ps-3" 
										 th:if="${#fields.hasErrors('currentPassword')}" 
										 th:errors="*{currentPassword}">
									</div>
								</div>

								<div class="mb-3">
									<label for="newPassword1" class="form-label fw-bold ms-3">새 비밀번호</label>
									<input type="password" class="form-control rounded-pill p-3"
										th:field="*{newPassword1}" placeholder="변경할 경우에만 입력하세요."
										aria-describedby="passwordHelp"
										th:classappend="${#fields.hasErrors('newPassword1')} ? 'is-invalid' : ''">
									<div id="passwordHelp" class="form-text small text-muted ms-3">
										8~16자, 대/소문자, 숫자, 특수문자(!@#$%^&*)를 포함해야 합니다.
									</div>
									<!-- ▼▼▼ [ "필드별" 오류 메시지 추가 ] ▼▼▼ -->
									<div class="invalid-feedback ps-3" 
										 th:if="${#fields.hasErrors('newPassword1')}" 
										 th:errors="*{newPassword1}">
									</div>
								</div>

								<div class="mb-3">
									<label for="newPassword2" class="form-label fw-bold ms-3">새 비밀번호 확인</label>
									<input type="password" class="form-control rounded-pill p-3"
										th:field="*{newPassword2}" placeholder="변경할 경우에만 입력하세요."
										th:classappend="${#fields.hasErrors('newPassword2')} ? 'is-invalid' : ''">
									<!-- ▼▼▼ [ "필드별" 오류 메시지 추가 ] ▼▼▼ -->
									<div class="invalid-feedback ps-3" 
										 th:if="${#fields.hasErrors('newPassword2')}" 
										 th:errors="*{newPassword2}">
									</div>
								</div>

								<div class="mb-4">
									<label for="email" class="form-label fw-bold ms-3">이메일</label>
									<input type="email" class="form-control rounded-pill p-3" th:field="*{email}"
										placeholder="이메일 주소를 입력해주세요."
										th:classappend="${#fields.hasErrors('email')} ? 'is-invalid' : ''">
									<!-- ▼▼▼ [ "필드별" 오류 메시지 추가 ] ▼▼▼ -->
									<div class="invalid-feedback ps-3" 
										 th:if="${#fields.hasErrors('email')}" 
										 th:errors="*{email}">
									</div>
								</div>

								<div class="d-grid mt-5">
									<button type="submit" class="btn btn-dark rounded-pill btn-lg p-3 w-100">수정하기</button>
								</div>

								<div class="d-grid mt-3">
									<a th:href="@{/user/delete/self}"
										class="btn btn-danger rounded-pill btn-lg p-3 w-100"
										onclick="return confirm('정말로 탈퇴하시겠습니까?');">회원 탈퇴</a>
								</div>

							</form>
						</div>
					</div>
				</div>
			</div>
		</div>
	</th:block>
</body>

</html>