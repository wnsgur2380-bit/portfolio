<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" 
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
    <title>ë©¤ë²„ì‹­ ê²°ì œ</title>
    </head>
<body>
<th:block layout:fragment="content">
    <div class="container my-5 text-center">
        <h2 class="fw-bold mb-4">ğŸ’ í”„ë¦¬ë¯¸ì—„ ë©¤ë²„ì‹­ ê²°ì œ</h2>
        
        <div class="card shadow-sm mx-auto" style="max-width: 500px;">
            <div class="card-body p-5">
                <h4 class="card-title mb-3">í‰ìƒ ë¬´ì œí•œ ìˆ˜ê°•ê¶Œ</h4>
                <p class="card-text text-muted mb-4">
                    ì‹¤ì œ ê²°ì œê°€ ì´ë£¨ì–´ì§€ì§€ ì•ŠëŠ” <span class="text-danger fw-bold">í…ŒìŠ¤íŠ¸ ê²°ì œ</span>ì…ë‹ˆë‹¤.<br>
                    (í† ìŠ¤ í…ŒìŠ¤íŠ¸ í™˜ê²½ ì‚¬ìš©)
                </p>
                <h3 class="fw-bold text-primary mb-4">50,000ì›</h3>

                <button type="button" class="btn btn-primary btn-lg w-100" onclick="requestPayment()">
                    ê²°ì œí•˜ê¸°
                </button>
            </div>
        </div>
    </div>
</th:block>

<th:block layout:fragment="script">
    
    <script src="https://js.tosspayments.com/v1/payment"></script>

    <script th:inline="javascript">
        // 2. í† ìŠ¤í˜ì´ë¨¼ì¸  ì´ˆê¸°í™” (ê³µê°œ í…ŒìŠ¤íŠ¸ í´ë¼ì´ì–¸íŠ¸ í‚¤ ì§ì ‘ ì…ë ¥)
        // ë°˜ë“œì‹œ 'test_ck_'ë¡œ ì‹œì‘í•´ì•¼ í•©ë‹ˆë‹¤.
        var tossPayments = TossPayments('test_ck_DpexMgkW36zbEWKYGqBB3GbR5ozO');

        function requestPayment() {
            // ì£¼ë¬¸ ID ìƒì„±
            var orderId = 'ORDER_' + new Date().getTime(); 
            
            // ê²°ì œì°½ í˜¸ì¶œ
            tossPayments.requestPayment('ì¹´ë“œ', {
                amount: 50,
                orderId: orderId,
                orderName: 'ì…íŠ¸ì˜ í”„ë¦¬ë¯¸ì—„ ë©¤ë²„ì‹­',
                customerName: /*[[${user.userName}]]*/ 'ê³ ê°ëª…',
                
                successUrl: window.location.origin + '/api/payments/success',
                failUrl: window.location.origin + '/api/payments/fail',
            })
            .catch(function (error) {
                if (error.code === 'USER_CANCEL') {
                    // ì‚¬ìš©ìê°€ ì°½ì„ ë‹«ì€ ê²½ìš° (ë¬´ì‹œ)
                } else {
                    alert("ê²°ì œ ì—°ë™ ì˜¤ë¥˜: " + error.message);
                }
            });
        }
    </script>
</th:block>
</body>
</html>