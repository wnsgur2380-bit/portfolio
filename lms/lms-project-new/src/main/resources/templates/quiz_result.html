<!DOCTYPE html>
<html lang="ko" 
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
    <title th:text="|퀴즈 결과: ${attempt.quiz.quizTitle}|"></title>
</head>
<body>
<th:block layout:fragment="content">
    <div class="container my-4">
        
        <h2 th:text="|퀴즈 결과: ${attempt.quiz.quizTitle}|"></h2>
        
        <div class="alert alert-primary" role="alert">
            <h4 class="alert-heading">최종 점수: <span th:text="${attempt.score}"></span>점</h4>
            
            <div>
                총 20문제 중 <span th:text="${#lists.size(answers.?[correct == true])}"></span>개를 맞혔습니다.
                
                <th:block th:if="${attempt.quiz.quizType == 'LEVEL_TEST' and attempt.user.level != null}">
                     <hr> <span class="fw-bold" th:text="|'${attempt.user.level.levelName}'|"></span> 단계 학습부터 시작합니다!
                </th:block>
                
                <th:block th:if="${attempt.quiz.quizType != null and #strings.startsWith(attempt.quiz.quizType, 'PROMOTION_TEST')}">
                    <hr>
                    <th:block th:if="${attempt.score >= 80 and attempt.user.level != null}">
                        <span class="fw-bold" th:text="|축하합니다! 이제 '${attempt.user.level.levelName}' 단계 학습을 하실 수 있습니다!|"></span>
                    </th:block>
                    <th:block th:if="${attempt.score < 80}">
                        <span class="fw-bold">아쉽지만 합격 기준(80점)을 넘지 못했습니다. 다시 학습해보고 도전하세요!</span>
                    </th:block>
                </th:block>
				<div class="text-center my-3">
				   	<a th:href="@{/classes/list}" class="btn btn-primary">강의 목록으로 돌아가기</a>
				</div>
            </div>
        </div>

        
        <h4 class="my-4">상세 채점 결과</h4>

        <div th:if="${answers != null}" th:each="answer, iter : ${answers}" class="card mb-3">
            
            <div class="card-header fw-bold" 
                 th:classappend="${answer.correct} ? 'bg-success-subtle' : 'bg-danger-subtle'">
                
                <span th:text="|Q${iter.count}. ${answer.qQuestion.quizContent}|"></span>
                
                <span th:if="${answer.correct}" class="badge bg-success ms-2">정답</span>
                <span th:if="${!answer.correct}" class="badge bg-danger ms-2">오답</span>
            </div>
            <div class="card-body">
                <p>
                    <strong>내 답변:</strong> 
                    <span th:text="${answer.userAnswer} ?: '선택 안함'"
                          th:class="${!answer.correct} ? 'text-danger'"></span>
                </p>
                <p class="mb-0">
                    <strong>정답:</strong>
                    <span th:text="${answer.qQuestion.correctAnswer}" class="text-primary"></span>
                </p>
            </div>
        </div>
        
        <div th:if="${#lists.isEmpty(answers)}" class="alert alert-warning">
            상세 채점 결과를 불러오는 데 실패했습니다. (컨트롤러 확인 필요)
        </div>
    </div>
</th:block>
</body>
</html>